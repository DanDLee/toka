<html><head><title>toka.nbk: threading model</title>
</head>
<body>


<p><b>toka.nbk:</b> <a href="home.html">Home</a> | <a href="index.html">Index</a> | Next Page: <a href="timelibrary.html">TimeLibrary</a> | Previous Page: <a href="structlibrary.html">StructLibrary</a></p>

<hr>

<h1>&nbsp;threading model</h1>


<p>Toka compiles to <i>threaded code</i>. This is a technique involving
laying down a list of addresses. The specific form is <i>call
threading</i>, with the possibility for specialized opcodes intermixed.
(At present there is one special opcode, 0, which marks the end of a quote)
</p>
<p>As an example of the threading model, consider the following quote:
</p>
<pre> [ a b c 1 2 + . ]
</pre>

<p>This is compiled into a list of addresses similar to the following:
</p>
<pre> call_quote, a, call_quote, b, call_quote, c, lit, 1, lit 2, +, ., 0
</pre>

<p>When quotes or numbers are compiled, a hidden primitive is compiled in
first. These <i>helpers</i> take care of actually invoking the following
quote pointer or pushing the number to the stack.
</p>
<p>When this quote is invoked, <i>a</i> will be called. After it finishes
executing, <i>b</i> will be called, and so on until <i>0</i> is
encountered. At that point, the <a href="vmc.html">vm_run()</a> function exits.</p>

<hr>

<p><b>toka.nbk:</b> <a href="home.html">Home</a> | <a href="index.html">Index</a> | Next Page: <a href="timelibrary.html">TimeLibrary</a> | Previous Page: <a href="structlibrary.html">StructLibrary</a></p>

<hr>

<p><i>Notebook exported on Tuesday, 12 June 2007, 20:51:59 PM EDT</i></p>

</body></html>
