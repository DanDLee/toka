<html><head><title>toka.nbk: Lesson 2</title>
</head>
<body>


<p><b>toka.nbk:</b> <a href="home.html">Home</a> | <a href="index.html">Index</a> | Next Page: <a href="lesson_3.html">Lesson 3</a> | Previous Page: <a href="lesson_1.html">Lesson 1</a></p>

<hr>

<h1>&nbsp;Lesson 2</h1>


<h2>Review</h2>

<p>In the previous lesson we learned to: 
</p>

<ul>
<li> Display the stack with <b>:stack</b> 
<li> Push numbers on the stack by typing them 
<li> Control the number base with <b>hex</b> and <b>decimal</b> 
<li> Execute words by typing their names 

</ul>

<h2>Stack Diagrams</h2>

<p>Pay attention to this section because it introduces notation that will be
used over and over.
</p>
<p>Since Toka words use the stack for arguments and results, their
description must tell you the arguments that they pop from the stack and
the results that they push back on the stack. That is done with a <i>stack
diagram</i>.
</p>
<pre> +  ( n1 n2 -- n3 )
</pre>

<p>That indicates that the Toka word <b>+</b>, which we saw in the last lesson,
pops two numbers n1 and n2 from the stack and pushes back one number n3.
The list of items before the "--" is the arguments, the list after is the
results. In each list, the items at the right is the top of the stack.
</p>
<p>In general, Toka words can take any number of arguments and leave any
number of results.
</p>
<p>This is purely a notation convention. The Toka interpreter does not
process stack diagrams other than to skip them. The way it knows to skip
them is because the Toka word <b>(</b> introduces a comment, which is
terminated by the next <b>)</b>. 
</p>
<p>Another example:
</p>
<pre> :stack  ( -- )
</pre>

<p>That means that <b>:stack</b> has no net stack effect. It doesn't pop
anything off the stack (no arguments) and it doesn't leave any extra
items on the stack after it finishes. It might push and pop numbers while
it is executing, but when it is done, the stack is the same as it was
before.
</p>
<pre> .  ( n -- )
</pre>

<p>The word <b>.</b> (which displays a number), pops its one argument from the
stack and leaves nothing in its place.
</p>
<p>The names in the argument and result lists (e.g. "n1", "n2", "n3") are
arbitrary, but as an aid to understanding, they are often chosen to
convey extra information. For example: 
</p>
<pre> type  ( adr -- )
</pre>

<p>We haven't seen the word <b>type</b> yet, but clearly it takes one
argument, an address. It pops the argument from the stack, leaving
nothing in its place. 
</p>
<p>Conventionally, stack item names beginning with "n" refer to signed
integers, "u" to unsigned integers, "d" to double numbers (two stack
numbers interpreted as a 64-bit integer), "adr" to addresses, "flag" to
values that are either true (0xfffffff) or false (0). But that is not a
hard and fast rule.
</p>
<p>Toka also has a shorter form of stack comments that is often used. See
<a href="stack_comments.html">Stack Comments</a> for further details on the short form.
</p>
<h2>How Comments Work</h2>

<p>The following is in some sense an implementation detail, but it's good to
understand it, because it is key to Toka's approach to syntax, which is
vastly different to most other languages.
</p>
<p>In the section above I mentioned that the word <b>(</b> skips to the next
<b>)</b>. That might seem like an exception to the rule that the
interpreter only parses whitespace-delimited words, but it is not.
</p>
<p>What actually happens is that the main interpreter loop only sees the
<b>(</b>. The <b>(</b> must be followed by whitespace, otherwise the
interpreter will not parse just </b>(</b> but rather some longer string
beginning with </b>(</b>. The interpreter then looks in the list of
defined words for one named <b>(</b>, and executes it.
</p>
<p>The behavior of the <b>(</b> word is to call the parser, asking it to collect a sequence of characters delimited by <b>)</b>, and then to discard the result. So
Any word can call the input parser, not just the main interpreter.
</p>
<p>The parser itself can use any character as a delimiter, not just
whitespace. The main interpreter only asks the parser for
whitespace-delimited words, but other words can and do parse using other
delimiters.
</p>
<p>This same approach (main interpreter calls a word that then parses using
a different delimiter) is also used for string literals where the
delimiter is <b>"</b>. 
</p>
<p>You can, if you wish, call the parser yourself from user code, to collect
any kind of string you want. It's best to use this capability sparingly
to avoid confusion, but it illustrates the fact that the entire Toka
system is available to you; nothing is magic or hidden.
</p>
<h2>Comment to End of Line</h2>

<p>The <b>( .... )</b> comment form stops at the <b>)</b>; stuff after it will be interpreted as usual. To comment out everything else on the line, use <b>#!</b>. 
</p>
<pre> #! everything after the first #! will be ignored
</pre>

<p>Note that the <b>#!</b> must be followed by whitespace, because <b>#!</b>
is just a word like anything else. The way that <b>#!</b> works is to
call the parser with a delimiter value (10) that matches a line ending
character, discarding the result. The parser will stop at the end of the
line, having found the delimiter. 
</p>
<p><i>Thus endeth the lesson</i></p>

<hr>

<p><b>toka.nbk:</b> <a href="home.html">Home</a> | <a href="index.html">Index</a> | Next Page: <a href="lesson_3.html">Lesson 3</a> | Previous Page: <a href="lesson_1.html">Lesson 1</a></p>

<hr>

<p><i>Notebook exported on Saturday, 30 June 2007, 16:25:11 PM EDT</i></p>

</body></html>
