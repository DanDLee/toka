<html><head><title>toka.nbk: garbage collector</title>
</head>
<body>


<p><b>toka.nbk:</b> <a href="home.html">Home</a> | <a href="index.html">Index</a> | Next Page: <a href="lesson_5.html">Lesson 5</a> | Previous Page: <a href="extending_the_language.html">Extending the Language</a></p>

<hr>

<h1>&nbsp;garbage collector</h1>


<p>The Toka implementation makes heavy use of dynamically allocated memory.
To help avoid memory leaks, the memory allocation provides a very simple
form of <i>garbage collection</i>.
</p>
<p>The model is very simple. Two lists are kept of pointers and corresponding
sizes are kept. One list is used primarily for user-level allocations,
and the other is only used by the primitives when they need to allocate
memory.
</p>
<p>When either list is filled, <b>gc()</b> is called. This frees up to 64
allocations from the internal list, and up to 32 allocations from the
user list. Allocations are freed from oldest to newest, and the newest
allocations in both lists (up to 32 in the user list and 64 in the
internal list) will be kept. This prevents recent creations from falling
out of scope until they can be used.
</p>
<p>Obviously there is also a way to mark entries as permanent. This is done
by <b>keep</b> (the <b><a href="gcc.html">gc_keep()</a></b> function). This routine skims
through the list of allocations (from most recent to oldest) looking for
a specific pointer. When found, that entry (and any subsequent
allocations -- in Toka these will almost always be subquotes, strings,
etc) are removed from the list.
</p>
<p>Information regarding the current status of the garbage collection
subsystem can be obtained via <b>:stat</b> (the <b><a href="debugc.html">vm_info()</a></b> function).</p>

<hr>

<p><b>toka.nbk:</b> <a href="home.html">Home</a> | <a href="index.html">Index</a> | Next Page: <a href="lesson_5.html">Lesson 5</a> | Previous Page: <a href="extending_the_language.html">Extending the Language</a></p>

<hr>

<p><i>Notebook exported on Friday, 27 July 2007, 21:04:36 PM EDT</i></p>

</body></html>
